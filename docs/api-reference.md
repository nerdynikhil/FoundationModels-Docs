# Foundation Models API Reference

## Overview

Complete technical reference for Apple's Foundation Models framework introduced at WWDC 2025.

## Core Framework

### FoundationModels Module

```swift
import FoundationModels
```

**Availability**: iOS 19.0+, macOS 15.0+, tvOS 19.0+, watchOS 11.0+

## Classes

### LanguageModelSession

The primary interface for interacting with Foundation Models.

```swift
class LanguageModelSession
```

#### Initializers

```swift
// Basic initialization with instructions
init(instructions: String)

// Initialization with tools
init(tools: [Tool], instructions: String)

// Initialization with instruction closure
init(@InstructionsBuilder instructions: () -> String)

// Initialization with tools and instruction closure
init(tools: [Tool], @InstructionsBuilder instructions: () -> String)
```

**Parameters:**
- `instructions`: System-level instructions that guide AI behavior
- `tools`: Array of custom tools the AI can use
- `@InstructionsBuilder`: Result builder for constructing complex instructions

#### Properties

```swift
var isResponding: Bool { get }
```

**Description**: Boolean indicating if the session is currently processing a request.

#### Methods

```swift
func streamResponse(to prompt: String) -> AsyncThrowingStream<String, Error>
```

**Description**: Generate streaming text response to a prompt.

**Parameters:**
- `prompt`: The input prompt for text generation

**Returns**: Async stream of partial text responses

**Throws**: `FoundationModelsError` on generation failure

---

```swift
func streamResponse<T: Generable>(
    to prompt: String, 
    generating type: T.Type
) -> AsyncThrowingStream<T.PartiallyGenerated, Error>
```

**Description**: Generate streaming structured content response.

**Parameters:**
- `prompt`: The input prompt for generation
- `type`: The `@Generable` type to generate

**Returns**: Async stream of partially generated structured content

**Throws**: `FoundationModelsError` on generation failure

---

```swift
func prewarm()
```

**Description**: Prepare the session for faster initial responses.

---

```swift
func invalidate()
```

**Description**: Clean up session resources and invalidate the session.

## Protocols

### Generable

Protocol for types that can be generated by Foundation Models.

```swift
@propertyWrapper
struct Generable
```

**Usage**: Apply to structs and enums to enable structured generation.

**Requirements**: Types must have properties with `@Guide` attributes.

**Generated Types**: Creates `TypeName.PartiallyGenerated` wrapper type.

### Guide

Property wrapper for guiding AI generation of specific properties.

```swift
@propertyWrapper
struct Guide
```

#### Initializers

```swift
init(description: String)
init(description: String, _ constraint: GuideConstraint)
```

**Parameters:**
- `description`: Natural language description of the property
- `constraint`: Optional constraint (e.g., `.count(n)`)

#### Guide Constraints

```swift
enum GuideConstraint {
    case count(Int)
    case range(ClosedRange<Int>)
    case format(String)
}
```

**Cases:**
- `.count(n)`: Specify exact number of elements for collections
- `.range(min...max)`: Specify range for numeric values
- `.format(pattern)`: Specify format pattern for strings

### Tool

Protocol for extending AI capabilities with custom functions.

```swift
protocol Tool {
    var name: String { get }
    var description: String { get }
    
    associatedtype Arguments: Generable
    
    func call(arguments: Arguments) async throws -> ToolOutput
}
```

#### Required Properties

```swift
var name: String { get }
```

**Description**: Unique identifier for the tool.

```swift
var description: String { get }
```

**Description**: Natural language description of what the tool does.

#### Required Methods

```swift
func call(arguments: Arguments) async throws -> ToolOutput
```

**Description**: Execute the tool with provided arguments.

**Parameters:**
- `arguments`: Type-safe arguments conforming to `@Generable`

**Returns**: `ToolOutput` containing the result

**Throws**: Any error during tool execution

### InstructionsRepresentable

Protocol for types that can be used as examples in session instructions.

```swift
protocol InstructionsRepresentable {
    static var instructionRepresentation: String { get }
}
```

**Default Implementation**: Automatically provided for `@Generable` types.

## Structures

### ToolOutput

Represents the output from a tool execution.

```swift
struct ToolOutput {
    let content: String
    
    init(_ content: String)
}
```

**Properties:**
- `content`: The textual result of the tool execution

### GenerationID

Unique identifier for generated content elements.

```swift
struct GenerationID: Hashable, Identifiable {
    let id: UUID
}
```

**Conformances**: `Hashable`, `Identifiable`

**Usage**: Used to track individual elements in partially generated content.

### PartiallyGenerated<T>

Wrapper type for streaming structured content generation.

```swift
struct PartiallyGenerated<T: Generable> {
    // Properties mirror T but as optionals
    // Available as T.PartiallyGenerated
}
```

**Generated Properties**: All properties from the wrapped type become optional.

**Methods:**
```swift
func isComplete() -> Bool
func finalize() throws -> T
```

## Result Builders

### InstructionsBuilder

Result builder for constructing session instructions.

```swift
@resultBuilder
struct InstructionsBuilder {
    static func buildBlock(_ components: String...) -> String
    static func buildArray(_ components: [String]) -> String
    static func buildOptional(_ component: String?) -> String
    static func buildEither(first component: String) -> String
    static func buildEither(second component: String) -> String
}
```

**Usage**: Enables declarative instruction construction in session initializers.

## Errors

### FoundationModelsError

Primary error type for Foundation Models operations.

```swift
enum FoundationModelsError: LocalizedError {
    case sessionNotReady
    case invalidPrompt
    case generationFailed(String)
    case toolExecutionFailed(String, Tool)
    case networkUnavailable
    case modelUnavailable
    case rateLimited
    case invalidConfiguration
}
```

**Cases:**
- `sessionNotReady`: Session not properly initialized
- `invalidPrompt`: Prompt format is invalid
- `generationFailed`: Generation process failed with details
- `toolExecutionFailed`: Tool execution failed with tool reference
- `networkUnavailable`: Network connection required but unavailable
- `modelUnavailable`: AI model temporarily unavailable
- `rateLimited`: Request rate limit exceeded
- `invalidConfiguration`: Session configuration is invalid

## Type Aliases

```swift
typealias GeneratedContent<T: Generable> = T.PartiallyGenerated
```

**Description**: Convenience alias for partially generated content.

## Extensions

### AsyncThrowingStream Extensions

Foundation Models provides convenience extensions for working with async streams.

```swift
extension AsyncThrowingStream where Element: Generable {
    func collect() async throws -> [Element]
    func first() async throws -> Element?
    func last() async throws -> Element?
}
```

### Collection Extensions

```swift
extension Collection where Element: Generable {
    func asPartiallyGenerated() -> [Element.PartiallyGenerated]
}
```

## Constants

### Model Configuration

```swift
struct ModelConfiguration {
    static let `default`: ModelConfiguration
    static let speed: ModelConfiguration
    static let balanced: ModelConfiguration
    static let quality: ModelConfiguration
}
```

### Generation Limits

```swift
struct GenerationLimits {
    static let maxPromptLength: Int = 32_768
    static let maxResponseLength: Int = 8_192
    static let maxToolCount: Int = 16
    static let maxCollectionCount: Int = 100
}
```

## Environment Values

### AI Configuration

```swift
extension EnvironmentValues {
    var aiConfiguration: AIConfiguration { get set }
}

struct AIConfiguration {
    let modelPreference: ModelPreference
    let streamingEnabled: Bool
    let debugMode: Bool
}

enum ModelPreference {
    case speed
    case balanced
    case quality
}
```

## Debugging and Logging

### Foundation Models Logging

```swift
class FoundationModelsLogger {
    static func enableLogging(level: LogLevel = .info)
    static func disableLogging()
    static func setLogLevel(_ level: LogLevel)
}

enum LogLevel {
    case debug
    case info
    case warning
    case error
}
```

### Debug Configuration

```swift
struct DebugConfiguration {
    var logPrompts: Bool = false
    var logResponses: Bool = false
    var logToolCalls: Bool = false
    var measurePerformance: Bool = false
}
```

## Platform-Specific Features

### iOS/iPadOS

```swift
#if os(iOS)
extension LanguageModelSession {
    func enableBackground() // Allow background processing
    func setEnergyMode(_ mode: EnergyMode) // Control energy usage
}

enum EnergyMode {
    case efficient
    case balanced
    case performance
}
#endif
```

### macOS

```swift
#if os(macOS)
extension LanguageModelSession {
    func setComputeMode(_ mode: ComputeMode) // Control compute resources
}

enum ComputeMode {
    case cpu
    case neural
    case auto
}
#endif
```

### watchOS

```swift
#if os(watchOS)
extension LanguageModelSession {
    func setComplexityLimit(_ limit: ComplexityLimit) // Limit for watch
}

enum ComplexityLimit {
    case simple
    case moderate
}
#endif
```

## Privacy and Security

### Privacy Configuration

```swift
struct PrivacyConfiguration {
    var allowCloudProcessing: Bool = false
    var allowTelemetry: Bool = false
    var dataRetentionDays: Int = 0
}
```

### Entitlements

Required entitlements for Foundation Models usage:

```xml
<key>com.apple.developer.foundation-models</key>
<true/>

<!-- Optional: For cloud processing -->
<key>com.apple.developer.foundation-models.cloud</key>
<true/>

<!-- Optional: For advanced features -->
<key>com.apple.developer.foundation-models.advanced</key>
<true/>
```

## Migration Guide

### From Beta to Release

```swift
// Beta API
let session = LanguageModelSession.create(
    withInstructions: "...",
    andTools: [...]
)
session.generateResponse(prompt: "...")

// Release API
let session = LanguageModelSession(tools: [...]) {
    "..."
}
let stream = session.streamResponse(to: "...")
```

### Deprecated APIs

```swift
@available(*, deprecated, renamed: "streamResponse(to:)")
func generateResponse(prompt: String) async throws -> String

@available(*, deprecated, message: "Use @Generable protocol instead")
func generateJSON<T: Codable>(prompt: String, type: T.Type) async throws -> T
```

## Performance Guidelines

### Session Management

```swift
// ✅ Good: Reuse sessions
class AIService {
    private let session = LanguageModelSession(instructions: "...")
}

// ❌ Bad: Create new sessions
func generate() {
    let session = LanguageModelSession(instructions: "...")
}
```

### Memory Management

```swift
// ✅ Good: Proper cleanup
deinit {
    session.invalidate()
}

// ✅ Good: Prewarming
override func viewDidLoad() {
    session.prewarm()
}
```

### Rate Limiting

```swift
// Built-in rate limiting
// Maximum 60 requests per minute per session
// Maximum 10 concurrent requests per session
```

## Version History

### iOS 19.0 / Foundation Models 1.0

- Initial release
- Basic text generation
- Structured generation with `@Generable`
- Tool protocol
- SwiftUI integration

### iOS 19.1 / Foundation Models 1.1

- Performance improvements
- Additional guide constraints
- Enhanced error handling
- Background processing support

### iOS 19.2 / Foundation Models 1.2

- Tool chaining support
- Advanced streaming options
- Memory optimizations
- Accessibility improvements

---

*This reference covers Foundation Models 1.2. Check for updates with each iOS release.*